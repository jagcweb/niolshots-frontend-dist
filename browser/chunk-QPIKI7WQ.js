import{b as ie,h as ne,j as re,n as pe}from"./chunk-A2M43TGP.js";import{$ as q,$a as I,Ba as F,Ha as X,Hb as ee,Ib as te,Jb as ae,Ka as v,M as Q,O as W,Pb as se,Qb as oe,Rb as le,S as z,Sb as me,Tb as ce,Ub as de,Va as d,Wa as i,Xa as r,Y as f,Ya as y,Z as _,_ as J,a as b,ab as S,b as C,bb as h,cb as R,d as $,db as x,eb as T,gb as o,hb as u,ib as w,jb as K,kb as Y,lb as Z,m as G,n as V,pb as B,q as j,ta as N,ua as U,wa as s,y as O}from"./chunk-N4Q2HGVV.js";var k=(a=>(a.SHOTS_GOALS="shots_goals",a.FOULS_CARDS="fouls_cards",a.SAVES="saves",a))(k||{});var H=class n{constructor(t){this.http=t}baseUrl="/api/stats";getMatchDetail(t){if(!t)return V(()=>new Error("matchId is required"));let e=`${this.baseUrl}/${t}`;return this.http.get(e).pipe(j(a=>{let m=C(b({},a.homeTeam),{teamColors:a.homeTeam.teamColors||{primary:"#1a78cf",secondary:"#ffffff",text:"#000000"}}),c=C(b({},a.awayTeam),{teamColors:a.awayTeam.teamColors||{primary:"#e74c3c",secondary:"#ffffff",text:"#000000"}}),ue=a.time||{},D=a.summary||{},ye=D.shots||[],E=D.stats||{},ge=D.fouls||[],ve=D.saves||[],fe=D.incidents||[],L=new Map,P=new Map;E?.home?.players&&E.home.players.forEach(l=>{l.player?.id&&L.set(l.player.id,l.player)}),E?.away?.players&&E.away.players.forEach(l=>{l.player?.id&&P.set(l.player.id,l.player)});let _e=(ye||[]).map(l=>{let g=!1,p=0;l.player?.id&&(L.has(l.player.id)?(g=!0,p=a.homeTeam?.id||0):P.has(l.player.id)&&(g=!1,p=a.awayTeam?.id||0));let M=l.player||{id:0,name:l.playerName||"Desconocido",shortName:l.playerName||"Desconocido",slug:"",position:"",jerseyNumber:""},xe=l.shotType==="goal";return{player:M,time:l.time||0,timeSeconds:(l.time||0)*60,teamId:p,isHome:g,shotType:l.shotType||"",situation:l.situation||"",bodyPart:l.bodyPart||"",xg:l.xg||l.expectedGoals||0,x:l.x||0,y:l.y||0,goalType:xe?l.goalType||"":null,hasAssist:l.hasAssist||!1,assistPlayer:l.assistPlayer||null}}).sort((l,g)=>g.time-l.time),Te=(ge||[]).map(l=>{let g="home",p=!0;return l.player?.id?L.has(l.player.id)?(p=!0,g="home"):P.has(l.player.id)&&(p=!1,g="away"):l.hasOwnProperty("isHome")?(p=l.isHome,g=l.isHome?"home":"away"):l.team&&(g=l.team,p=l.team==="home"),{playerId:l.playerId||l.player?.id||0,playerName:l.playerName||l.player?.name||"Desconocido",shirtNumber:l.shirtNumber||0,team:g,isHome:p,time:l.time||0,timeSeconds:(l.time||0)*60,foulType:l.foulType||"Falta",description:l.description||"",incidentId:l.incidentId||l.id||""}}),Se=(ve||[]).map(l=>{let g="home",p=!0;return l.player?.id&&(L.has(l.player.id)?(p=!0,g="home"):P.has(l.player.id)&&(p=!1,g="away")),C(b({},l),{team:g,isHome:p,player:l.player||{id:0,name:l.playerName||"Desconocido",shortName:l.playerName||"Desconocido",slug:"",position:"",jerseyNumber:""}})}),A=[];if(E){let l=E.home?.players||[],g=E.away?.players||[];l.forEach(p=>{if(p.player&&p.statistics){let M={id:p.player.id||0,name:p.player.name||"",shortName:p.player.shortName||"",slug:p.player.slug||"",position:p.player.position||"",jerseyNumber:p.jerseyNumber||""};A.push(C(b({},p.statistics),{player:M,teamFromLineup:"home"}))}}),g.forEach(p=>{if(p.player&&p.statistics){let M={id:p.player.id||0,name:p.player.name||"",shortName:p.player.shortName||"",slug:p.player.slug||"",position:p.player.position||"",jerseyNumber:p.jerseyNumber||""};A.push(C(b({},p.statistics),{player:M,teamFromLineup:"away"}))}})}return{id:a.id||0,status:a.status||{code:0,description:"Unknown",type:"notstarted"},startTimestamp:a.startTimestamp||0,homeTeam:m,awayTeam:c,time:ue,homeScore:a.homeScore?.current||a.homeScore?.display||a.homeScore||0,awayScore:a.awayScore?.current||a.awayScore?.display||a.awayScore||0,tournament:a.tournament||void 0,summary:{shots:_e,stats:A,fouls:Te,saves:Se,incidents:fe||[]}}}),O(a=>(console.error(`Error fetching match detail for ${t}:`,a),V(()=>new Error(`Error fetching match detail: ${a.message}`)))))}static \u0275fac=function(e){return new(e||n)(z(ie))};static \u0275prov=W({token:n,factory:n.\u0275fac,providedIn:"root"})};function be(n,t){n&1&&(i(0,"div",24),y(1,"div",25)(2,"div",26),i(3,"div",27)(4,"div",28),y(5,"div",29),i(6,"div",30),o(7,"NiolShots"),r()(),y(8,"div",31),i(9,"div",32),o(10,"Cargando estad\xEDsticas..."),r(),i(11,"div",33)(12,"div",34),y(13,"div",35),r()(),i(14,"div",36),y(15,"div",37)(16,"div",37)(17,"div",37),r()()())}function Ce(n,t){if(n&1){let e=I();i(0,"img",38),S("error",function(m){f(e);let c=h();return _(c.onImgError(m,"home"))}),r()}if(n&2){let e=h();d("src",e.homeTeamLogoUrl,U)("alt",e.homeTeamName)}}function Ie(n,t){if(n&1&&(i(0,"span",39),o(1),r()),n&2){let e=h();s(),u(e.homeTeamInitial)}}function De(n,t){if(n&1){let e=I();i(0,"img",38),S("error",function(m){f(e);let c=h();return _(c.onImgError(m,"away"))}),r()}if(n&2){let e=h();d("src",e.awayTeamLogoUrl,U)("alt",e.awayTeamName)}}function Me(n,t){if(n&1&&(i(0,"span",39),o(1),r()),n&2){let e=h();s(),u(e.awayTeamInitial)}}function Ne(n,t){if(n&1&&(i(0,"div",44)(1,"div",45)(2,"div",46),o(3),r(),i(4,"div",47),o(5),r(),i(6,"div",48),o(7),r()(),i(8,"div",49)(9,"div",50),y(10,"div",51)(11,"div",52),r()()()),n&2){let e=t.$implicit,a=h(2);s(3),u(e.isPercentage?e.home+"%":e.home),s(2),u(e.label),s(2),u(e.isPercentage?e.away+"%":e.away),s(3),x("width",a.calculateBarWidth(e.home,e.away,e.isPercentage).homeWidth,"%")("background-color",e.homeColor),s(),x("width",a.calculateBarWidth(e.home,e.away,e.isPercentage).awayWidth,"%")("background-color",e.awayColor)}}function Fe(n,t){if(n&1&&(i(0,"div",40)(1,"div",41)(2,"div",42),v(3,Ne,12,11,"div",43),r()()()),n&2){let e=h();s(3),d("ngForOf",e.statsData)("ngForTrackBy",e.trackByTime)}}function Le(n,t){n&1&&(i(0,"div",55),y(1,"i",56),i(2,"span"),o(3,"No hay datos de tiros disponibles"),r()())}function Pe(n,t){if(n&1&&y(0,"div",62),n&2){let e=t.$implicit,a=h(3);x("left",(e.x||0)*100,"%")("top",(e.y||0)*100,"%")("background",e.isHome?a.homeTeamColor:a.awayTeamColor),d("title",a.getPlayerName(e)+" ("+(e.shotType||"")+")")}}function Oe(n,t){if(n&1&&(i(0,"div",63)(1,"span",64),o(2),r(),i(3,"span",65),o(4),r(),i(5,"span",66),o(6),r(),i(7,"span",67),o(8),r()()),n&2){let e=t.$implicit,a=h(3);s(2),w("",e.time,"'"),s(2),u(a.getPlayerName(e)),s(2),u(e.shotType),s(),x("color",e.isHome?a.homeTeamColor:a.awayTeamColor),s(),w(" ",e.isHome?a.homeTeamName:a.awayTeamName," ")}}function ke(n,t){if(n&1&&(i(0,"div",57)(1,"div",58),v(2,Pe,1,7,"div",59),r(),i(3,"div",60),v(4,Oe,9,6,"div",61),r()()),n&2){let e=h(2);s(2),d("ngForOf",e.shotsData)("ngForTrackBy",e.trackByTime),s(2),d("ngForOf",e.shotsData)("ngForTrackBy",e.trackByTime)}}function He(n,t){if(n&1&&(i(0,"div",40),v(1,Le,4,0,"div",53)(2,ke,5,4,"div",54),r()),n&2){let e=h();s(),d("ngIf",e.shotsData.length===0),s(),d("ngIf",e.shotsData.length>0)}}function Ae(n,t){n&1&&(i(0,"span"),o(1,"tiros"),r())}function Ve(n,t){n&1&&(i(0,"span"),o(1,"faltas"),r())}function Ue(n,t){n&1&&(i(0,"span"),o(1,"paradas"),r())}function Re(n,t){if(n&1&&(i(0,"div",55),y(1,"i",83),i(2,"span"),o(3," No hay datos de "),v(4,Ae,2,0,"span",84)(5,Ve,2,0,"span",84)(6,Ue,2,0,"span",84),o(7," disponibles "),r()()),n&2){let e=h(3);s(),T("fa-futbol",e.selectedEventType===e.DataType.SHOTS_GOALS)("fa-hand",e.selectedEventType===e.DataType.FOULS_CARDS||e.selectedEventType===e.DataType.SAVES),s(3),d("ngIf",e.selectedEventType===e.DataType.SHOTS_GOALS),s(),d("ngIf",e.selectedEventType===e.DataType.FOULS_CARDS),s(),d("ngIf",e.selectedEventType===e.DataType.SAVES)}}function Be(n,t){if(n&1&&(i(0,"span",99),o(1),r()),n&2){let e=h().$implicit,a=h(4);s(),u(a.getXGValue(e))}}function $e(n,t){n&1&&(i(0,"span"),o(1,"-"),r())}function Ge(n,t){if(n&1&&y(0,"span",100),n&2){let e=h().$implicit,a=h(4);d("innerHTML",a.highlightText(a.getAssistPlayerName(e),a.searchQuery),N)}}function je(n,t){n&1&&(i(0,"span"),o(1,"-"),r())}function Qe(n,t){if(n&1&&(i(0,"tr")(1,"td",87)(2,"span",95),o(3),r()(),i(4,"td",88)(5,"span"),o(6),r()(),i(7,"td",89),y(8,"span",96),r(),i(9,"td",90)(10,"span",66),o(11),r()(),i(12,"td",91),v(13,Be,2,1,"span",97)(14,$e,2,0,"span",84),r(),i(15,"td",92),o(16),r(),i(17,"td",93),v(18,Ge,1,1,"span",98)(19,je,2,0,"span",84),r()()),n&2){let e=t.$implicit,a=h(4);T("home-row",e.isHome)("away-row",!e.isHome)("goal-row",a.isGoalRow(e.shotType))("no-match-row",a.searchQuery&&!a.getPlayerName(e).toLowerCase().includes(a.searchQuery.toLowerCase())&&!a.getAssistPlayerName(e).toLowerCase().includes(a.searchQuery.toLowerCase())),s(),x("border-left","3px solid "+(e.isHome?a.homeTeamColor:a.awayTeamColor)),s(2),w("",e.time,"'"),s(3),u(e.isHome?a.homeTeamName:a.awayTeamName),s(2),d("innerHTML",a.highlightText(a.getPlayerName(e),a.searchQuery),N),s(3),u(a.getShotTypeText(e.shotType)),s(2),d("ngIf",a.getXGValue(e)!=="-"),s(),d("ngIf",a.getXGValue(e)==="-"),s(2),u(a.getBodyPartText(e.bodyPart)),s(2),d("ngIf",a.getAssistPlayerName(e)!=="-"),s(),d("ngIf",a.getAssistPlayerName(e)==="-")}}function We(n,t){if(n&1&&(i(0,"div",85)(1,"table",86)(2,"thead")(3,"tr")(4,"th",87),o(5,"Min"),r(),i(6,"th",88),o(7,"Equipo"),r(),i(8,"th",89),o(9,"Jugador"),r(),i(10,"th",90),o(11,"Tipo"),r(),i(12,"th",91),o(13,"xG"),r(),i(14,"th",92),o(15,"Parte"),r(),i(16,"th",93),o(17,"Asistencia"),r()()(),i(18,"tbody"),v(19,Qe,20,19,"tr",94),r()()()),n&2){let e=h(3);s(19),d("ngForOf",e.filteredEvents)("ngForTrackBy",e.trackByTime)}}function ze(n,t){if(n&1&&(i(0,"tr")(1,"td",87)(2,"span",95),o(3),r()(),i(4,"td",89),y(5,"span",103),r(),i(6,"td",90)(7,"span",104),o(8),r()(),i(9,"td",101),o(10),r()()),n&2){let e=t.$implicit,a=h(4);T("home-row",e.isHome||e.team==="home")("away-row",!e.isHome&&e.team!=="home")("no-match-row",a.searchQuery&&!a.getPlayerName(e).toLowerCase().includes(a.searchQuery.toLowerCase())),s(3),w("",e.time,"'"),s(2),d("innerHTML",a.highlightText(a.getPlayerName(e),a.searchQuery),N),s(3),u(a.getFoulTypeText(e.foulType)),s(2),u(a.getFoulDetails(e))}}function Je(n,t){if(n&1&&(i(0,"div",85)(1,"table",86)(2,"thead")(3,"tr")(4,"th",87),o(5,"Min"),r(),i(6,"th",89),o(7,"Jugador"),r(),i(8,"th",90),o(9,"Tipo"),r(),i(10,"th",101),o(11,"Detalles"),r()()(),i(12,"tbody"),v(13,ze,11,10,"tr",102),r()()()),n&2){let e=h(3);s(13),d("ngForOf",e.filteredEvents)("ngForTrackBy",e.trackByTime)}}function qe(n,t){if(n&1&&(i(0,"tr")(1,"td",87)(2,"span",95),o(3),r()(),i(4,"td",89),y(5,"span",103),r(),i(6,"td",90)(7,"span",105),o(8),r()()()),n&2){let e=t.$implicit,a=h(4);T("home-row",e.isHome||e.team==="home")("away-row",!e.isHome&&e.team!=="home")("no-match-row",a.searchQuery&&!a.getPlayerName(e).toLowerCase().includes(a.searchQuery.toLowerCase())),s(3),w("",e.time,"'"),s(2),d("innerHTML",a.highlightText(a.getPlayerName(e),a.searchQuery),N),s(3),w("\u{1F9E4} ",a.getSaveTypeText(e.saveType))}}function Xe(n,t){if(n&1&&(i(0,"div",85)(1,"table",86)(2,"thead")(3,"tr")(4,"th",87),o(5,"Min"),r(),i(6,"th",89),o(7,"Portero"),r(),i(8,"th",90),o(9,"Tipo"),r()()(),i(10,"tbody"),v(11,qe,9,9,"tr",102),r()()()),n&2){let e=h(3);s(11),d("ngForOf",e.filteredEvents)("ngForTrackBy",e.trackByTime)}}function Ke(n,t){if(n&1){let e=I();i(0,"div",73)(1,"div",74)(2,"div",75),J(),i(3,"svg",76),y(4,"circle",77)(5,"line",78),r()(),q(),i(6,"input",79),S("input",function(m){f(e);let c=h(2);return _(c.onSearchQueryChange(m.target.value))}),r(),i(7,"button",80),S("click",function(){f(e);let m=h(2);return _(m.clearSearch())}),o(8," \xD7 "),r(),i(9,"div",81),o(10),r()(),v(11,Re,8,7,"div",53)(12,We,20,2,"div",82)(13,Je,14,2,"div",82)(14,Xe,12,2,"div",82),r()}if(n&2){let e=h(2);s(),T("has-text",e.searchQuery.length>0),s(5),d("value",e.searchQuery),s(3),T("has-results",e.searchQuery.length>0),s(),w(" ",e.searchResultsText," "),s(),d("ngIf",e.filteredEvents.length===0&&!e.searchQuery),s(),d("ngIf",e.selectedEventType===e.DataType.SHOTS_GOALS&&e.filteredEvents.length>0),s(),d("ngIf",e.selectedEventType===e.DataType.FOULS_CARDS&&e.filteredEvents.length>0),s(),d("ngIf",e.selectedEventType===e.DataType.SAVES&&e.filteredEvents.length>0)}}function Ye(n,t){if(n&1){let e=I();i(0,"div",40)(1,"div",68)(2,"select",69),Z("ngModelChange",function(m){f(e);let c=h();return Y(c.selectedEventType,m)||(c.selectedEventType=m),_(m)}),i(3,"option",70),o(4,"Tiros y Goles"),r(),i(5,"option",70),o(6,"Faltas y Tarjetas"),r(),i(7,"option",70),o(8,"Paradas"),r()()(),i(9,"div",71),v(10,Ke,15,10,"div",72),r()()}if(n&2){let e=h();s(2),K("ngModel",e.selectedEventType),s(),d("value",e.DataType.SHOTS_GOALS),s(2),d("value",e.DataType.FOULS_CARDS),s(2),d("value",e.DataType.SAVES),s(3),d("ngIf",e.selectedEventType===e.DataType.SHOTS_GOALS||e.selectedEventType===e.DataType.FOULS_CARDS||e.selectedEventType===e.DataType.SAVES)}}function Ze(n,t){n&1&&(i(0,"div",40)(1,"div",106),y(2,"div",107)(3,"div",108),r()())}var he=class n{constructor(t,e,a,m){this.statsService=t;this.matchesService=e;this.route=a;this.router=m}matchId=null;detail=null;loading=!0;activeTab="stats";secondsUntilRefresh=30;selectedEventType="shots_goals";statsData=[];shotsData=[];foulsData=[];savesData=[];searchQuery="";filteredEvents=[];DataType=k;scoreboardGradient="linear-gradient(to right, #f0f0f0, #d0d0d0)";searchResultsText="";homeTeamImageUrl=null;awayTeamImageUrl=null;subscriptions=new $;refreshInterval;timerInterval;cacheKey="matchDetailCache";ngOnInit(){this.subscriptions.add(this.route.paramMap.subscribe(a=>{if(this.matchId=a.get("id"),this.matchId){let m=this.getCachedDetail(this.matchId);m?(this.detail=m,this.loading=!1,this.updateComputedData(),this.loadTeamImages(),this.refreshSummaryOnly()):this.loadDetails(),this.startAutoRefresh()}}));let e=new URLSearchParams(window.location.search).get("eventType");e&&Object.values(k).includes(e)&&(this.selectedEventType=e)}ngOnDestroy(){this.subscriptions.unsubscribe(),this.stopAutoRefresh()}loadDetails(){this.matchId!==null&&(this.loading=!0,this.subscriptions.add(this.statsService.getMatchDetail(this.matchId).subscribe({next:t=>{this.detail={id:t.id||0,status:t.status||{code:0,description:"Unknown",type:"notstarted"},startTimestamp:t.startTimestamp||Math.floor(Date.now()/1e3),homeTeam:t.homeTeam,awayTeam:t.awayTeam,time:t.time,homeScore:t.homeScore,awayScore:t.awayScore,tournament:t.tournament,summary:{shots:t.summary?.shots||[],stats:t.summary?.stats||[],fouls:t.summary?.fouls||[],saves:t.summary?.saves||[],incidents:t.summary?.incidents||[]}},this.cacheDetail(this.matchId,this.detail),this.loading=!1,this.updateComputedData(),this.loadTeamImages()},error:t=>{console.error("Error loading match details:",t),this.loading=!1}})))}loadTeamImages(){if(this.detail){if(this.detail.homeTeam?.id){let t=this.getCachedTeamLogo(Number(this.detail.homeTeam.id));t?this.homeTeamImageUrl=t:this.loadTeamImage(Number(this.detail.homeTeam.id),"home")}if(this.detail.awayTeam?.id){let t=this.getCachedTeamLogo(Number(this.detail.awayTeam.id));t?this.awayTeamImageUrl=t:this.loadTeamImage(Number(this.detail.awayTeam.id),"away")}}}getCachedTeamLogo(t){try{let e=localStorage.getItem(`teamLogo_${t}`);if(!e)return null;let a=JSON.parse(e),m=1440*60*1e3;return Date.now()-a.timestamp>m?(localStorage.removeItem(`teamLogo_${t}`),null):a.url}catch{return localStorage.removeItem(`teamLogo_${t}`),null}}cacheTeamLogo(t,e){try{let a={url:e,timestamp:Date.now()};localStorage.setItem(`teamLogo_${t}`,JSON.stringify(a))}catch(a){console.warn(`Error caching team logo ${t}:`,a)}}loadTeamImage(t,e){console.log(`Loading ${e} team image for team ${t}`),this.subscriptions.add(this.matchesService.getTeamImage(t).pipe(O(a=>(console.warn(`Error loading ${e} team image:`,a),G(""))),Q(a=>{a&&a.trim()?(this.cacheTeamLogo(t,a),e==="home"?this.homeTeamImageUrl=a:this.awayTeamImageUrl=a,console.log(`\u2713 Loaded ${e} team image`)):console.warn(`\u2717 Failed to load ${e} team image - empty URL`)})).subscribe())}refreshSummaryOnly(){this.loading=!0,this.matchId!==null&&this.subscriptions.add(this.statsService.getMatchDetail(this.matchId).subscribe({next:t=>{this.detail&&t.summary&&(this.detail.summary={shots:t.summary.shots||[],stats:t.summary.stats||[],fouls:t.summary.fouls||[],saves:t.summary.saves||[],incidents:t.summary.incidents||[]},this.updateComputedData()),this.loading=!1},error:t=>{console.error("Error refreshing summary:",t),this.loading=!1}}))}updateComputedData(){this.detail&&(this.statsData=this.calculateStatsData(),this.shotsData=this.getShotsData(),this.foulsData=this.getFoulsData(),this.savesData=this.getSavesData(),this.updateFilteredEvents())}setTab(t){this.activeTab=t,this.updateFilteredEvents()}onEventTypeChange(t){this.selectedEventType=t,this.updateFilteredEvents()}onSearchQueryChange(t){this.searchQuery=t,this.updateFilteredEvents()}clearSearch(){this.searchQuery="",this.updateFilteredEvents()}updateFilteredEvents(){let t=[];switch(this.selectedEventType){case"shots_goals":t=this.shotsData;break;case"fouls_cards":t=this.foulsData;break;case"saves":t=this.savesData;break}if(this.searchQuery.trim()){let e=this.searchQuery.toLowerCase().trim();t=t.filter(a=>{let m=(a.player?.name||a.playerName||"").toLowerCase(),c=(a.assistPlayer?.name||"").toLowerCase();return m.includes(e)||c.includes(e)})}this.filteredEvents=t.sort((e,a)=>a.time-e.time)}startAutoRefresh(){this.stopAutoRefresh(),this.timerInterval=setInterval(()=>{this.secondsUntilRefresh--,this.secondsUntilRefresh<0&&(this.secondsUntilRefresh=30)},1e3),this.refreshInterval=setInterval(()=>{this.activeTab==="stats"&&(this.matchId!==null&&this.getCachedDetail(this.matchId)?(this.detail=this.getCachedDetail(this.matchId),this.refreshSummaryOnly()):this.loadDetails()),this.secondsUntilRefresh=30},3e4)}stopAutoRefresh(){this.refreshInterval&&clearInterval(this.refreshInterval),this.timerInterval&&clearInterval(this.timerInterval)}goBack(){this.stopAutoRefresh(),this.router.navigate(["/matches"])}cacheDetail(t,e){localStorage.setItem(this.cacheKey,JSON.stringify({matchId:t,data:e,timestamp:Date.now()}))}getCachedDetail(t){let e=localStorage.getItem(this.cacheKey);if(!e)return null;try{let a=JSON.parse(e);if(a.matchId==t&&Date.now()-a.timestamp<3600*1e3){let m=a.data;return m.summary={shots:m.summary?.shots||[],stats:m.summary?.stats||[],fouls:m.summary?.fouls||[],saves:m.summary?.saves||[],incidents:m.summary?.incidents||[]},m}return null}catch{return null}}get matchTitle(){return this.detail?`${this.detail.homeTeam?.name||"Local"} vs ${this.detail.awayTeam?.name||"Visitante"}`:"Detalles del partido"}get homeTeamName(){return this.detail?.homeTeam?.name||"Local"}get awayTeamName(){return this.detail?.awayTeam?.name||"Visitante"}get homeScore(){return typeof this.detail?.homeScore=="number"?this.detail.homeScore:0}get awayScore(){return typeof this.detail?.awayScore=="number"?this.detail.awayScore:0}get matchTime(){if(!this.detail)return"";if(this.detail.status?.type==="inprogress"){let t=this.detail.time?.minute;if(typeof t=="number")return`${t}'`;let e=this.detail.time?.currentPeriodStartTimestamp||this.detail.statusTime?.timestamp;if(e){let a=Math.floor(Date.now()/1e3),m=Math.floor((a-e)/60)+1,c=this.detail.time?.extra||0;return m+=Math.floor(c/60),`${Math.max(m,0)}'`}return"0'"}return this.detail.status?.type==="finished"?"FT":""}get matchState(){if(!this.detail)return"";switch(this.detail.status?.type){case"inprogress":return"En directo";case"finished":return"Finalizado";default:return"Programado"}}get homeTeamLogoUrl(){return this.homeTeamImageUrl}get awayTeamLogoUrl(){return this.awayTeamImageUrl}get homeTeamInitial(){return this.detail?.homeTeam?.slug?.[0]?.toUpperCase()||"?"}get awayTeamInitial(){return this.detail?.awayTeam?.slug?.[0]?.toUpperCase()||"?"}get homeTeamColor(){return this.detail?.homeTeam?.teamColors?.primary||"#1a78cf"}get awayTeamColor(){return this.detail?.awayTeam?.teamColors?.secondary||"#e74c3c"}calculateStatsData(){if(!this.detail?.summary)return[];let t=this.detail.summary,e=this.homeTeamColor,a=this.awayTeamColor;return[{label:"Tiros",home:t.shots?.filter(c=>c.isHome).length??0,away:t.shots?.filter(c=>!c.isHome).length??0,homeColor:e,awayColor:a},{label:"Tiros a puerta",home:t.shots?.filter(c=>c.isHome&&c.shotType==="OnTarget").length??0,away:t.shots?.filter(c=>!c.isHome&&c.shotType==="OnTarget").length??0,homeColor:e,awayColor:a},{label:"Faltas",home:t.fouls?.filter(c=>c.team==="home").length??0,away:t.fouls?.filter(c=>c.team==="away").length??0,homeColor:e,awayColor:a},{label:"Paradas",home:t.saves?.filter(c=>c.team==="home").length??0,away:t.saves?.filter(c=>c.team==="away").length??0,homeColor:e,awayColor:a}]}getShotsData(){return this.detail?.summary?.shots??[]}getFoulsData(){return this.detail?.summary?.fouls??[]}getSavesData(){return this.detail?.summary?.saves??[]}calculateBarWidth(t,e,a=!1){if(a)return{homeWidth:t,awayWidth:e};let m=t+e;if(m===0)return{homeWidth:50,awayWidth:50};let c=Math.round(t/m*100);return{homeWidth:c,awayWidth:100-c}}getShotTypeText(t){switch((t||"").toLowerCase()){case"goal":return"\u26BD Gol";case"ontarget":case"on_target":case"save":return"\u{1F3AF} Tiro a puerta";case"miss":case"offtarget":case"off_target":return"\u274C Tiro fuera";default:return"\u274C Tiro fuera"}}getBodyPartText(t){if(!t)return"-";let e=t.toLowerCase();return e.includes("right")&&e.includes("foot")?"Pie derecho":e.includes("left")&&e.includes("foot")?"Pie izquierdo":e.includes("head")?"Cabeza":e.includes("other")?"Otra parte":t}getXGValue(t){let e=t.xG??t.xg??t.expected_goals??t.expectedGoals;return e!=null&&!isNaN(parseFloat(e))?parseFloat(e).toFixed(2):"-"}getFoulTypeText(t){let e=(t||"").toLowerCase();return e.includes("roja")&&e.includes("doble amarilla")?"\u{1F7E8}\u{1F7E5} 2\xAA Amarilla":e.includes("roja")?"\u{1F7E5} Tarjeta roja":e.includes("amarilla")?"\u{1F7E8} Tarjeta amarilla":e.includes("tarjeta")?"\u{1F7E8} Tarjeta":"\u26A0\uFE0F Falta"}getFoulDetails(t){return t.foulType?.toLowerCase().includes("doble amarilla")?"Expulsi\xF3n por doble amonestaci\xF3n":t.description||"-"}getSaveTypeText(t){return t||"Parada"}isGoalRow(t){return(t||"").toLowerCase()==="goal"}getPlayerName(t){return t.player?.name||t.playerName||"Desconocido"}getAssistPlayerName(t){return this.isGoalRow(t.shotType)&&t.hasAssist&&t.assistPlayer?t.assistPlayer.name:"-"}highlightText(t,e){if(!e.trim())return t;let a=new RegExp(`(${e})`,"gi");return t.replace(a,'<span class="highlight-match" style="color: black;">$1</span>')}trackByTime(t,e){return`${e.time}-${t}`}onImgError(t,e){let a=t.target,m=a?.parentElement;a&&m&&(a.style.display="none",m.innerHTML=e==="home"?this.homeTeamInitial:this.awayTeamInitial,m.classList.add("fallback-logo"))}static \u0275fac=function(e){return new(e||n)(F(H),F(pe),F(ne),F(re))};static \u0275cmp=X({type:n,selectors:[["app-match-detail"]],decls:47,vars:29,consts:[["homeInitial",""],["awayInitial",""],["id","match-detail-view"],["class","niol-splash-loader",4,"ngIf"],[1,"match-detail-header"],[1,"back-btn",3,"click"],[1,"fas","fa-arrow-left"],[1,"autorefresh-timer",2,"margin-left","20px","font-size","1rem"],[1,"fas","fa-sync-alt"],[1,"match-info-container"],[1,"match-scoreboard"],[1,"team","home-team"],[1,"team-logo","home-logo"],["class","team-logo-img","loading","lazy",3,"src","alt","error",4,"ngIf","ngIfElse"],[1,"team-name"],[1,"score"],[1,"match-status"],[1,"match-time"],[1,"match-state"],[1,"team","away-team"],[1,"team-logo","away-logo"],[1,"match-tabs"],[1,"tab-btn",3,"click"],["class","tab-content",4,"ngIf"],[1,"niol-splash-loader"],[1,"particles"],[1,"waves"],[1,"loader-container"],[1,"logo-container"],[1,"logo"],[1,"brand-name"],[1,"spinner"],[1,"loader-text"],[1,"progress-container"],[1,"progress-bar"],[1,"progress-fill"],[1,"loading-dots"],[1,"dot"],["loading","lazy",1,"team-logo-img",3,"error","src","alt"],[1,"fallback-logo"],[1,"tab-content"],[1,"stats-comparison"],[1,"stats-list"],["class","stat-item",4,"ngFor","ngForOf","ngForTrackBy"],[1,"stat-item"],[1,"stat-values"],[1,"home-value"],[1,"stat-label"],[1,"away-value"],[1,"stat-bars"],[1,"stat-bar-container"],[1,"stat-bar","home-bar"],[1,"stat-bar","away-bar"],["class","empty-state",4,"ngIf"],["class","pitch-container",4,"ngIf"],[1,"empty-state"],[1,"fas","fa-futbol"],[1,"pitch-container"],[1,"pitch"],["class","shot-marker",3,"left","top","background","title",4,"ngFor","ngForOf","ngForTrackBy"],[1,"shot-list"],["class","shot-item",4,"ngFor","ngForOf","ngForTrackBy"],[1,"shot-marker",3,"title"],[1,"shot-item"],[1,"shot-time"],[1,"shot-player"],[1,"shot-type"],[1,"shot-team"],[1,"events-selector"],[1,"event-type-dropdown",3,"ngModelChange","ngModel"],[3,"value"],[1,"events-container"],["class","shots-table-wrapper",4,"ngIf"],[1,"shots-table-wrapper"],[1,"shots-table-search"],[1,"search-icon"],["width","16","height","16","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["cx","11","cy","11","r","8"],["x1","21","y1","21","x2","16.65","y2","16.65"],["type","text","placeholder","Buscar por nombre de jugador...","autocomplete","off",3,"input","value"],["type","button","aria-label","Limpiar b\xFAsqueda",1,"search-clear",3,"click"],[1,"search-results"],["class","shots-table-container",4,"ngIf"],[1,"fas"],[4,"ngIf"],[1,"shots-table-container"],[1,"shots-table"],[1,"col-time"],[1,"col-team"],[1,"col-player"],[1,"col-type"],[1,"col-xg"],[1,"col-body"],[1,"col-assist"],[3,"home-row","away-row","goal-row","no-match-row",4,"ngFor","ngForOf","ngForTrackBy"],[1,"time-badge"],[1,"player-name",2,"color","#222",3,"innerHTML"],["class","xg-value",4,"ngIf"],[3,"innerHTML",4,"ngIf"],[1,"xg-value"],[3,"innerHTML"],[1,"col-details"],[3,"home-row","away-row","no-match-row",4,"ngFor","ngForOf","ngForTrackBy"],[1,"player-name",3,"innerHTML"],[1,"foul-type"],[1,"save-type"],[1,"lineups-container"],[1,"team-lineup","home-lineup"],[1,"team-lineup","away-lineup"]],template:function(e,a){if(e&1){let m=I();i(0,"div",2),v(1,be,18,0,"div",3),i(2,"div",4)(3,"button",5),S("click",function(){return f(m),_(a.goBack())}),y(4,"i",6),o(5," Volver a partidos "),r(),i(6,"h2"),o(7),r(),i(8,"span",7),y(9,"i",8),o(10),r()(),i(11,"div",9)(12,"div",10)(13,"div",11)(14,"div",12),v(15,Ce,1,2,"img",13)(16,Ie,2,1,"ng-template",null,0,B),r(),i(18,"h3",14),o(19),r(),i(20,"div",15),o(21),r()(),i(22,"div",16)(23,"div",17),o(24),r(),i(25,"div",18),o(26),r()(),i(27,"div",19)(28,"div",20),v(29,De,1,2,"img",13)(30,Me,2,1,"ng-template",null,1,B),r(),i(32,"h3",14),o(33),r(),i(34,"div",15),o(35),r()()(),i(36,"div",21)(37,"button",22),S("click",function(){return f(m),_(a.setTab("stats"))}),o(38," Estad\xEDsticas "),r(),i(39,"button",22),S("click",function(){return f(m),_(a.setTab("events"))}),o(40," Est. Individuales "),r(),i(41,"button",22),S("click",function(){return f(m),_(a.setTab("lineup"))}),o(42," Alineaciones "),r()(),v(43,Fe,4,2,"div",23)(44,He,3,2,"div",23)(45,Ye,11,5,"div",23)(46,Ze,4,0,"div",23),r()()}if(e&2){let m=R(17),c=R(31);s(),d("ngIf",a.loading),s(),x("display",a.loading?"none":"flex"),s(5),u(a.matchTitle),s(3),w(" Actualizando en ",a.secondsUntilRefresh,"s "),s(),x("display",a.loading?"none":"block"),s(),x("background",a.scoreboardGradient),s(3),d("ngIf",a.homeTeamLogoUrl)("ngIfElse",m),s(4),u(a.homeTeamName),s(2),u(a.homeScore),s(3),u(a.matchTime),s(2),u(a.matchState),s(3),d("ngIf",a.awayTeamLogoUrl)("ngIfElse",c),s(4),u(a.awayTeamName),s(2),u(a.awayScore),s(2),T("active",a.activeTab==="stats"),s(2),T("active",a.activeTab==="events"),s(2),T("active",a.activeTab==="lineup"),s(2),d("ngIf",a.activeTab==="stats"),s(),d("ngIf",a.activeTab==="shots"),s(),d("ngIf",a.activeTab==="events"),s(),d("ngIf",a.activeTab==="lineup")}},dependencies:[ae,ee,te,de,me,ce,le,se,oe],encapsulation:2})};export{he as MatchDetailComponent};
